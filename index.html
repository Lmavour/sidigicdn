// index.js
const axios = require("axios");
const FormData = require("form-data");

module.exports = async (req, res) => {
  if (req.method === "POST") {
    try {
      const chunks = [];
      for await (const chunk of req) {
        chunks.push(chunk);
      }
      const buffer = Buffer.concat(chunks);

      const form = new FormData();
      form.append("files[]", buffer, {
        filename: "upload-" + Date.now(),
        contentType: "application/octet-stream"
      });

      const pomf = await axios.post("https://pomf.lain.la/upload.php", form, {
        headers: {
          ...form.getHeaders(),
          origin: "https://pomf.lain.la",
          "user-agent": "Postify/1.0.0"
        }
      });

      res.setHeader("Content-Type", "application/json");
      res.status(200).json({ url: pomf?.data?.files?.[0]?.url || null });
    } catch (err) {
      res.status(500).json({ error: err.message });
    }
  } else {
    res.status(200).json({ message: "Pomf Proxy API is running" });
  }
};
